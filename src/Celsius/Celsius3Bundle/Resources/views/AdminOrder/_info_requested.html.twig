{% include 'CelsiusCelsius3Bundle:Layout:cci.js.twig' with { 'form': request_form } %}

{% if hasState %}
<div id="{{ 'info_'~state }}" class="collapse {{ isCurrent?'in':'' }}">
    <div class="well">
        {% for event in order.getState(constant('Celsius\\Celsius3Bundle\\Manager\\StateManager::STATE__REQUESTED'), instance).events %}
            {{ render_request_event(event, order)|raw }}
        {% endfor %}
        {% if not isDelivered %}
            <dl class="dl-horizontal">
                <dt>{{ 'Actions'|trans }}</dt>
                <dd><a class="request-link" href="#request-modal" role="button" data-toggle="modal">{{ 'request'|capitalize|trans }}</a></dd>
            </dl>
        {% endif %}
    </div>
</div>
{% else %}
<div id="{{ 'info_'~state~'_disabled' }}" class="collapse">
    <div class="well">
        {% if not isDelivered %}
            <dl class="dl-horizontal">
                <dt>{{ 'Actions'|trans }}</dt>
                <dd><a class="request-link" href="#request-modal" role="button" data-toggle="modal">{{ 'request'|capitalize|trans }}</a></dd>
            </dl>
        {% endif %}
    </div>
</div>
{% endif %}

<div id="request-modal" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="request-modal-label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="request-modal-label">{{ 'Request'|trans }}</h3>
    </div>
    <div class="modal-body">
        <form id="requestForm" action="{{ path('admin_order_event', { 'id': order.id, 'event': constant('Celsius\\Celsius3Bundle\\Manager\\EventManager::EVENT__REQUEST') })|raw }}" method="post" class="form-horizontal">
            {{ form_widget(request_form, {'form_type': 'horizontal'}) }}
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button class="btn btn-primary" id="doRequest">{{ 'Save'|trans }}</button>
    </div>
</div>

<script type="text/javascript">    
    $(document).ready(function () {
        $('#doRequest').click(function(){
            $("#requestForm").submit();
        });
        
        $(document).on('click', '.doReceive', function(){
            $($(this).attr('value')).submit();
        });
    });
</script>