{% include 'CelsiusCelsius3Bundle:Layout:cci.js.twig' with { 'form': request_form } %}

<div id="{{ 'info_'~state }}" class="collapse {{ isCurrent?'in':'' }}">
    <div class="well">
        {% if order.hasState(constant('Celsius\\Celsius3Bundle\\Manager\\StateManager::STATE__REQUESTED'), instance) %}
            {% for event in order.getState(constant('Celsius\\Celsius3Bundle\\Manager\\StateManager::STATE__REQUESTED'), instance).events %}
                {{ render(controller('CelsiusCelsius3Bundle:AdminOrder:eventRequest', { 'event': event, 'document': order })) }}
            {% endfor %}
        {% endif %}
        {% if not isDelivered %}
            <p><a class="request-link" href="#request-modal" role="button" data-toggle="modal">{{ 'request'|capitalize|trans }}</a></p>
        {% endif %}
    </div>
</div>

<div id="{{ 'info_'~state~'_disabled' }}" class="collapse">
    <div class="well">
        {% if not isDelivered %}
            <p><a class="request-link" href="#request-modal" role="button" data-toggle="modal">{{ 'request'|capitalize|trans }}</a></p>
        {% endif %}
    </div>
</div>

<div id="request-modal" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="request-modal-label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="request-modal-label">{{ 'Request'|trans }}</h3>
    </div>
    <div class="modal-body">
        <form id="requestForm" action="{{ path('admin_order_event', { 'id': order.id, 'event': constant('Celsius\\Celsius3Bundle\\Manager\\EventManager::EVENT__REQUEST') })|raw }}" method="post">
            {{ form_widget(request_form) }}
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button class="btn btn-primary" id="doRequest">{{ 'Save'|trans }}</button>
    </div>
</div>

<script type="text/javascript">    
    $(document).ready(function () {
        $('#doRequest').click(function(){
            $("#requestForm").submit();
        });
        
        $('.doReceive').live('click', function(){
            $($(this).attr('value')).submit();
        });
    });
</script>